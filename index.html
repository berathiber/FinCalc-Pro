<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinCalc Pro - Premium Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        :root{--transition-speed:0.35s;--radius-sm:10px;--radius-md:16px;--radius-lg:24px;--radius-xl:32px}
        [data-theme="dark"]{--primary:#6366f1;--primary-dark:#4f46e5;--primary-light:#818cf8;--primary-glow:rgba(99,102,241,0.15);--primary-glow-strong:rgba(99,102,241,0.25);--secondary:#8b5cf6;--accent:#06b6d4;--success:#10b981;--success-bg:rgba(16,185,129,0.1);--success-border:rgba(16,185,129,0.2);--warning:#f59e0b;--warning-bg:rgba(245,158,11,0.1);--warning-border:rgba(245,158,11,0.2);--danger:#ef4444;--danger-bg:rgba(239,68,68,0.1);--danger-border:rgba(239,68,68,0.2);--info:#3b82f6;--info-bg:rgba(59,130,246,0.1);--info-border:rgba(59,130,246,0.2);--syria:#ef4444;--syria-bg:rgba(239,68,68,0.08);--syria-border:rgba(239,68,68,0.2);--bg-body:#09090b;--bg-sidebar-solid:#18181b;--bg-card:rgba(24,24,27,0.6);--bg-card-solid:#18181b;--bg-card-hover:rgba(39,39,42,0.8);--bg-input:rgba(39,39,42,0.6);--bg-input-solid:#27272a;--bg-dropdown:#27272a;--bg-elevated:rgba(39,39,42,0.9);--text-primary:#fafafa;--text-secondary:#a1a1aa;--text-muted:#71717a;--border-color:rgba(63,63,70,0.5);--border-subtle:rgba(63,63,70,0.3);--shadow-sm:0 1px 2px rgba(0,0,0,0.3);--shadow-md:0 4px 16px rgba(0,0,0,0.3);--shadow-lg:0 8px 32px rgba(0,0,0,0.4);--shadow-xl:0 16px 64px rgba(0,0,0,0.5);--overlay-bg:rgba(0,0,0,0.7);--gradient-subtle:linear-gradient(135deg,rgba(99,102,241,0.05),rgba(139,92,246,0.05));--gradient-primary:linear-gradient(135deg,#6366f1,#8b5cf6);--gradient-danger:linear-gradient(135deg,#ef4444,#f97316);--gradient-warm:linear-gradient(135deg,#f59e0b,#ef4444)}
        [data-theme="light"]{--primary:#6366f1;--primary-dark:#4f46e5;--primary-light:#818cf8;--primary-glow:rgba(99,102,241,0.08);--primary-glow-strong:rgba(99,102,241,0.15);--secondary:#8b5cf6;--accent:#0891b2;--success:#059669;--success-bg:rgba(5,150,105,0.06);--success-border:rgba(5,150,105,0.15);--warning:#d97706;--warning-bg:rgba(217,119,6,0.06);--warning-border:rgba(217,119,6,0.15);--danger:#dc2626;--danger-bg:rgba(220,38,38,0.06);--danger-border:rgba(220,38,38,0.15);--info:#2563eb;--info-bg:rgba(37,99,235,0.06);--info-border:rgba(37,99,235,0.15);--syria:#dc2626;--syria-bg:rgba(220,38,38,0.04);--syria-border:rgba(220,38,38,0.12);--bg-body:#f8fafc;--bg-sidebar-solid:#ffffff;--bg-card:rgba(255,255,255,0.7);--bg-card-solid:#ffffff;--bg-card-hover:rgba(248,250,252,0.9);--bg-input:rgba(241,245,249,0.8);--bg-input-solid:#f1f5f9;--bg-dropdown:#ffffff;--bg-elevated:rgba(255,255,255,0.95);--text-primary:#0f172a;--text-secondary:#475569;--text-muted:#94a3b8;--border-color:rgba(226,232,240,0.8);--border-subtle:rgba(226,232,240,0.5);--shadow-sm:0 1px 2px rgba(0,0,0,0.04);--shadow-md:0 4px 16px rgba(0,0,0,0.06);--shadow-lg:0 8px 32px rgba(0,0,0,0.08);--shadow-xl:0 16px 64px rgba(0,0,0,0.1);--overlay-bg:rgba(15,23,42,0.5);--gradient-subtle:linear-gradient(135deg,rgba(99,102,241,0.03),rgba(139,92,246,0.03));--gradient-primary:linear-gradient(135deg,#6366f1,#8b5cf6);--gradient-danger:linear-gradient(135deg,#dc2626,#ea580c);--gradient-warm:linear-gradient(135deg,#d97706,#dc2626)}
        *{box-sizing:border-box;margin:0;padding:0}
        body{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg-body);min-height:100vh;color:var(--text-secondary);transition:background var(--transition-speed),color var(--transition-speed);-webkit-font-smoothing:antialiased;overflow-x:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
        body::before{content:'';position:fixed;top:0;left:0;right:0;bottom:0;background:radial-gradient(ellipse 80% 50% at 50% -20%,var(--primary-glow),transparent);pointer-events:none;z-index:0}
        input,textarea,select{-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text}
        .app-container{display:grid;grid-template-columns:290px 1fr;min-height:100vh;position:relative;z-index:1}
        @media(max-width:1024px){.app-container{grid-template-columns:1fr}.sidebar{position:fixed;left:-310px;z-index:1000;transition:left 0.4s cubic-bezier(0.16,1,0.3,1)}.sidebar.open{left:0}.mobile-header{display:flex!important}}
        .sidebar{background:var(--bg-sidebar-solid);border-right:1px solid var(--border-color);padding:28px 20px;display:flex;flex-direction:column;position:sticky;top:0;height:100vh;overflow-y:auto;z-index:10}
        .logo{display:flex;align-items:center;gap:14px;margin-bottom:36px;padding:0 4px}
        .logo-icon{width:46px;height:46px;background:var(--gradient-primary);border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:1.4rem;box-shadow:0 4px 12px rgba(99,102,241,0.3);position:relative;overflow:hidden}
        .logo-icon::after{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,0.2),transparent)}
        .logo-text h1{font-size:1.2rem;font-weight:800;color:var(--text-primary);letter-spacing:-0.03em}
        .logo-text span{font-size:0.65rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:1.5px;font-weight:600}
        .theme-toggle{display:flex;align-items:center;gap:12px;padding:14px 16px;background:var(--bg-input);border-radius:var(--radius-md);margin-bottom:28px;border:1px solid var(--border-subtle)}
        .theme-toggle span{font-size:0.82rem;color:var(--text-muted);font-weight:500}
        .theme-switch{position:relative;width:52px;height:28px;margin-left:auto;flex-shrink:0}
        .theme-switch input{opacity:0;width:0;height:0}
        .theme-slider{position:absolute;cursor:pointer;inset:0;background:#3f3f46;transition:0.4s;border-radius:28px}
        .theme-slider:before{position:absolute;content:"üåô";height:22px;width:22px;left:3px;bottom:3px;background:#fff;transition:0.4s;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px}
        .theme-switch input:checked+.theme-slider{background:var(--primary)}
        .theme-switch input:checked+.theme-slider:before{transform:translateX(24px);content:"‚òÄÔ∏è"}
        .nav-section{margin-bottom:28px}
        .nav-label{font-size:0.65rem;font-weight:700;color:var(--text-muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:12px;padding-left:14px}
        .nav-item{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:var(--radius-sm);cursor:pointer;transition:all 0.2s;margin-bottom:4px;color:var(--text-secondary);font-weight:500;font-size:0.88rem;position:relative}
        .nav-item::before{content:'';position:absolute;left:0;top:0;bottom:0;width:0;background:var(--gradient-primary);border-radius:0 4px 4px 0;transition:width 0.2s}
        .nav-item:hover{background:var(--bg-input);color:var(--text-primary)}
        .nav-item.active{background:var(--primary-glow-strong);color:var(--primary-light);font-weight:600}
        .nav-item.active::before{width:3px}
        .nav-item img{width:26px;height:18px;border-radius:3px;object-fit:cover}
        .rates-panel{background:var(--gradient-subtle);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);padding:22px;margin-top:auto}
        .rates-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
        .rates-header h3{font-size:0.82rem;font-weight:700;color:var(--text-primary)}
        .live-badge{display:flex;align-items:center;gap:6px;font-size:0.6rem;color:var(--success);font-weight:700;background:var(--success-bg);padding:4px 10px;border-radius:20px;border:1px solid var(--success-border)}
        .live-badge::before{content:'';width:6px;height:6px;background:var(--success);border-radius:50%;animation:pulse 2s infinite}
        @keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.4;transform:scale(0.7)}}
        .rate-row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--border-subtle)}
        .rate-row:last-child{border-bottom:none}
        .rate-row .currency{display:flex;align-items:center;gap:10px;font-size:0.78rem;color:var(--text-secondary);font-weight:500}
        .rate-row .currency img{width:22px;height:15px;border-radius:2px}
        .rate-row .value{font-size:0.82rem;font-weight:700;color:var(--text-primary);font-family:'SF Mono','Fira Code',monospace}
        .btn-sync-mini{width:100%;padding:12px;background:transparent;border:1px solid var(--border-color);color:var(--primary);border-radius:var(--radius-sm);cursor:pointer;font-size:0.78rem;font-weight:600;margin-top:16px;transition:all 0.25s;display:flex;align-items:center;justify-content:center;gap:8px;font-family:inherit}
        .btn-sync-mini:hover{background:var(--primary-glow);border-color:var(--primary)}
        .auto-sync-info{display:flex;align-items:center;gap:6px;font-size:0.68rem;color:var(--text-muted);margin-top:10px;justify-content:center}
        .auto-sync-info .dot{width:5px;height:5px;background:var(--success);border-radius:50%;animation:pulse 2s infinite}
        .countdown{font-family:'SF Mono','Fira Code',monospace;color:var(--primary);font-weight:600}
        .main-content{padding:36px 40px;overflow-y:auto;position:relative}
        @media(max-width:768px){.main-content{padding:20px 16px}}
        .mobile-header{display:none;justify-content:space-between;align-items:center;padding:16px 20px;background:var(--bg-sidebar-solid);border-bottom:1px solid var(--border-color);position:sticky;top:0;z-index:100}
        .mobile-header .logo{margin-bottom:0}
        .btn-menu{width:44px;height:44px;background:var(--bg-input);border:1px solid var(--border-subtle);border-radius:var(--radius-sm);color:var(--text-primary);font-size:1.3rem;cursor:pointer;display:flex;align-items:center;justify-content:center}
        .sidebar-overlay{display:none;position:fixed;inset:0;background:var(--overlay-bg);z-index:999}
        .sidebar-overlay.active{display:block}
        .top-bar{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:36px;flex-wrap:wrap;gap:16px}
        .page-title h2{font-size:2.2rem;font-weight:800;color:var(--text-primary);margin-bottom:6px;letter-spacing:-0.04em;background:linear-gradient(135deg,var(--text-primary),var(--text-secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .page-title p{color:var(--text-muted);font-size:0.95rem}
        .btn-settings{padding:12px 22px;background:var(--bg-card);border:1px solid var(--border-color);color:var(--primary);border-radius:980px;cursor:pointer;font-weight:600;font-size:0.82rem;display:flex;align-items:center;gap:8px;transition:all 0.25s;font-family:inherit}
        .btn-settings:hover{background:var(--primary-glow);border-color:var(--primary);transform:translateY(-1px)}
        .calc-container{display:grid;grid-template-columns:1fr 420px;gap:28px}
        @media(max-width:1200px){.calc-container{grid-template-columns:1fr}}
        .calc-card{background:var(--bg-card);backdrop-filter:blur(20px);border-radius:var(--radius-xl);padding:36px;border:1px solid var(--border-color);box-shadow:var(--shadow-lg);position:relative;overflow:hidden}
        .calc-card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--primary-glow-strong),transparent)}
        .calc-card h3{font-size:1.15rem;font-weight:700;color:var(--text-primary);margin-bottom:28px;display:flex;align-items:center;gap:12px}
        .calc-card h3 .icon{width:40px;height:40px;background:var(--gradient-primary);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.1rem}
        .form-row{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-bottom:20px}
        @media(max-width:600px){.form-row{grid-template-columns:1fr}}
        .form-group{margin-bottom:22px}
        label{display:block;font-size:0.75rem;font-weight:600;color:var(--text-muted);margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px}
        input,select{width:100%;padding:14px 16px;background:var(--bg-input);border:1px solid var(--border-subtle);border-radius:var(--radius-sm);color:var(--text-primary);font-size:0.95rem;font-weight:500;transition:all 0.25s;font-family:inherit}
        input::placeholder{color:var(--text-muted)}
        input:focus,select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px var(--primary-glow);background:var(--bg-input-solid)}
        select{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%2371717a' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;padding-right:44px}
        select option{background:var(--bg-dropdown);color:var(--text-primary)}
        .currency-input{display:flex;align-items:center;background:var(--bg-input);border:1px solid var(--border-subtle);border-radius:var(--radius-sm);padding:0 16px;transition:all 0.25s}
        .currency-input:focus-within{border-color:var(--primary);box-shadow:0 0 0 4px var(--primary-glow)}
        .currency-input img{width:32px;height:22px;border-radius:4px;object-fit:cover}
        .currency-input select{border:none;background:transparent;padding:14px 12px;box-shadow:none}
        .currency-input select:focus{box-shadow:none}
        .mode-toggle{display:grid;grid-template-columns:repeat(3,1fr);gap:4px;background:var(--bg-input);padding:5px;border-radius:var(--radius-md);margin-bottom:28px;border:1px solid var(--border-subtle)}
        .mode-toggle.two-col{grid-template-columns:repeat(2,1fr)}
        .mode-toggle.five-col{grid-template-columns:repeat(5,1fr)}
        @media(max-width:600px){.mode-toggle.five-col{grid-template-columns:repeat(3,1fr)}}
        @media(max-width:420px){.mode-toggle.five-col{grid-template-columns:repeat(2,1fr)}}
        .mode-btn{padding:12px 10px;background:transparent;border:none;border-radius:var(--radius-sm);color:var(--text-muted);font-size:0.78rem;font-weight:600;cursor:pointer;transition:all 0.25s;display:flex;align-items:center;justify-content:center;gap:6px;flex-direction:column;font-family:inherit}
        .mode-btn:hover{color:var(--text-primary);background:var(--bg-card-hover)}
        .mode-btn.active{background:var(--bg-card-solid);color:var(--text-primary);box-shadow:var(--shadow-md)}
        .mode-btn.syria-active{background:var(--syria);color:white;box-shadow:0 4px 12px rgba(239,68,68,0.3)}
        .mode-btn img{width:22px;height:15px;border-radius:2px}
        .mode-btn .mode-label{font-size:0.68rem;opacity:0.8}
        .syria-section{background:var(--syria-bg);border:1px solid var(--syria-border);border-radius:var(--radius-lg);padding:28px;margin-bottom:20px;position:relative}
        .syria-section::before{content:'üá∏üáæ SYRIAN POUND TRANSFER';position:absolute;top:-12px;left:20px;background:var(--gradient-danger);color:white;font-size:0.62rem;font-weight:700;padding:5px 14px;border-radius:20px}
        .syria-section label{color:var(--syria)}
        .country-section{background:var(--info-bg);border:1px solid var(--info-border);border-radius:var(--radius-lg);padding:28px;margin-bottom:20px}
        .country-section label{color:var(--info)}
        .city-selector{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:18px}
        @media(max-width:600px){.city-selector{grid-template-columns:repeat(2,1fr)}}
        .city-btn{padding:14px 12px;background:var(--bg-card-solid);border:1px solid var(--border-color);border-radius:var(--radius-sm);cursor:pointer;text-align:center;transition:all 0.25s}
        .city-btn:hover{border-color:var(--primary);transform:translateY(-1px)}
        .city-btn.active{background:var(--primary);border-color:var(--primary);color:white}
        .city-btn .city-name{font-weight:700;font-size:0.85rem;color:var(--text-primary)}
        .city-btn.active .city-name{color:white}
        .city-btn .city-rate{font-size:0.68rem;color:var(--text-muted);margin-top:4px}
        .city-btn.active .city-rate{color:rgba(255,255,255,0.8)}
        .syp-result-box{background:var(--syria-bg);border:1px solid var(--syria-border);padding:28px;border-radius:var(--radius-lg);margin:18px 0;text-align:center;position:relative;overflow:hidden}
        .syp-result-box::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--gradient-danger)}
        .syp-result-box .label{color:var(--syria);font-size:0.72rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;margin-bottom:10px}
        .syp-result-box .amount{color:var(--text-primary);font-size:2rem;font-weight:800;font-family:'SF Mono','Fira Code',monospace}
        .syp-result-box .rate-info{font-size:0.75rem;color:var(--text-muted);margin-top:10px}
        .override-zone{background:var(--warning-bg);border:1px solid var(--warning-border);border-radius:var(--radius-lg);padding:28px;margin-top:24px;position:relative}
        .override-zone::before{content:'‚úèÔ∏è MANUAL OVERRIDE';position:absolute;top:-12px;left:20px;background:var(--gradient-warm);color:white;font-size:0.62rem;font-weight:700;padding:5px 14px;border-radius:20px}
        .override-zone label{color:var(--warning)}
        .override-zone input,.override-zone select{background:var(--bg-card-solid);border-color:var(--warning-border)}
        .btn-reset{width:100%;padding:14px;background:transparent;border:1px solid var(--border-color);color:var(--text-muted);border-radius:var(--radius-sm);cursor:pointer;font-size:0.82rem;font-weight:600;margin-top:16px;transition:all 0.25s;font-family:inherit}
        .btn-reset:hover{border-color:var(--primary);color:var(--primary);background:var(--primary-glow)}
        .fee-tier-badge{display:inline-flex;align-items:center;gap:8px;font-size:0.72rem;font-weight:600;padding:8px 14px;border-radius:980px;margin-bottom:16px}
        .fee-tier-badge.auto{background:var(--info-bg);color:var(--info);border:1px solid var(--info-border)}
        .fee-tier-badge.manual{background:var(--warning-bg);color:var(--warning);border:1px solid var(--warning-border)}
        .results-card{background:var(--bg-card);backdrop-filter:blur(20px);border-radius:var(--radius-xl);padding:36px;border:1px solid var(--border-color);position:sticky;top:36px;box-shadow:var(--shadow-lg);overflow:hidden}
        .results-card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--primary-glow-strong),transparent)}
        .results-card h3{font-size:1.1rem;font-weight:700;color:var(--text-primary);margin-bottom:28px;display:flex;align-items:center;gap:10px}
        .result-item{display:flex;justify-content:space-between;align-items:center;padding:14px 0;border-bottom:1px solid var(--border-subtle)}
        .result-item:last-of-type{border-bottom:none}
        .result-item .label{color:var(--text-muted);font-size:0.85rem;font-weight:500}
        .result-item .value{color:var(--text-primary);font-weight:600;font-size:0.92rem;font-family:'SF Mono','Fira Code',monospace}
        .result-item.highlight .value{color:var(--primary)}
        .result-item.syria-highlight .value{color:var(--syria);font-weight:700}
        .result-divider{height:1px;background:var(--border-subtle);margin:8px 0}
        .result-total{background:var(--gradient-primary);margin:28px -36px -36px;padding:32px 36px;border-radius:0 0 var(--radius-xl) var(--radius-xl);position:relative;overflow:hidden}
        .result-total::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,0.1),transparent)}
        .result-total.syria-total{background:var(--gradient-danger)}
        .result-total .label{color:rgba(255,255,255,0.7);font-size:0.75rem;font-weight:600;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;position:relative}
        .result-total .amount{font-size:2.2rem;font-weight:800;color:white;font-family:'SF Mono','Fira Code',monospace;letter-spacing:-0.03em;position:relative}
        .jod-box{background:var(--success-bg);border:1px solid var(--success-border);padding:18px 22px;border-radius:var(--radius-md);margin:16px 0;display:none}
        .jod-box .label{color:var(--success);font-size:0.72rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;margin-bottom:6px}
        .jod-box .amount{color:var(--success);font-size:1.5rem;font-weight:800;font-family:'SF Mono','Fira Code',monospace}
        .btn-receipt{width:100%;padding:16px;background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.2);border-radius:var(--radius-md);color:white;font-size:0.92rem;font-weight:600;cursor:pointer;margin-top:20px;display:flex;align-items:center;justify-content:center;gap:10px;transition:all 0.25s;font-family:inherit}
        .btn-receipt:hover{background:rgba(255,255,255,0.25)}
        .modal-overlay{display:none;position:fixed;inset:0;background:var(--overlay-bg);backdrop-filter:blur(12px);z-index:1000;overflow-y:auto;padding:40px 20px}
        .modal-overlay.active{display:block;animation:fadeIn 0.3s}
        @keyframes fadeIn{from{opacity:0}to{opacity:1}}
        .modal-container{max-width:1000px;margin:0 auto;background:var(--bg-card-solid);border-radius:var(--radius-xl);border:1px solid var(--border-color);overflow:hidden;animation:modalSlide 0.4s cubic-bezier(0.16,1,0.3,1);box-shadow:var(--shadow-xl)}
        @keyframes modalSlide{from{opacity:0;transform:translateY(30px) scale(0.97)}to{opacity:1;transform:translateY(0) scale(1)}}
        .modal-header{display:flex;justify-content:space-between;align-items:center;padding:24px 32px;border-bottom:1px solid var(--border-color);background:var(--bg-elevated)}
        .modal-header h3{font-size:1.2rem;font-weight:700;color:var(--text-primary);display:flex;align-items:center;gap:12px}
        .modal-close{width:34px;height:34px;background:var(--bg-input);border:1px solid var(--border-subtle);border-radius:50%;color:var(--text-muted);font-size:1.1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s}
        .modal-close:hover{background:var(--danger);color:white;border-color:var(--danger)}
        .modal-body{padding:32px;max-height:70vh;overflow-y:auto}
        .modal-tabs{display:flex;gap:8px;margin-bottom:28px;padding-bottom:18px;border-bottom:1px solid var(--border-subtle);overflow-x:auto;flex-wrap:wrap}
        .modal-tab{padding:10px 20px;background:var(--bg-input);border:1px solid var(--border-subtle);border-radius:980px;color:var(--text-muted);font-size:0.82rem;font-weight:600;cursor:pointer;transition:all 0.25s;white-space:nowrap;display:flex;align-items:center;gap:8px;font-family:inherit}
        .modal-tab:hover{color:var(--text-primary);border-color:var(--border-color)}
        .modal-tab.active{background:var(--gradient-primary);color:white;border-color:transparent}
        .modal-tab img{width:20px;height:14px;border-radius:2px}
        .settings-section{display:none}
        .settings-section.active{display:block}
        .sync-bar{display:flex;align-items:center;justify-content:space-between;padding:22px;background:var(--primary-glow);border-radius:var(--radius-lg);margin-bottom:28px;border:1px solid rgba(99,102,241,0.15);flex-wrap:wrap;gap:16px}
        .sync-info{display:flex;flex-direction:column;gap:4px}
        .sync-info .source-label{font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;font-weight:600}
        .sync-info .source-name{font-size:0.92rem;font-weight:700;color:var(--primary)}
        .sync-info .last-update{font-size:0.78rem;color:var(--text-muted)}
        .btn-sync{padding:12px 24px;background:var(--gradient-primary);border:none;border-radius:980px;color:white;font-weight:600;font-size:0.82rem;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all 0.25s;font-family:inherit}
        .btn-sync:hover{transform:translateY(-1px)}
        .btn-sync.loading{opacity:0.7;pointer-events:none}
        .spinner{width:16px;height:16px;border:2px solid rgba(255,255,255,0.3);border-top-color:white;border-radius:50%;animation:spin 0.8s linear infinite;display:none}
        .btn-sync.loading .spinner{display:block}
        .btn-sync.loading .btn-text{display:none}
        @keyframes spin{to{transform:rotate(360deg)}}
        .rate-table{width:100%;border-collapse:separate;border-spacing:0}
        .rate-table th{text-align:left;padding:14px 12px;background:var(--bg-input);color:var(--text-muted);font-size:0.7rem;font-weight:700;text-transform:uppercase;letter-spacing:0.8px}
        .rate-table th:first-child{border-radius:12px 0 0 12px}
        .rate-table th:last-child{border-radius:0 12px 12px 0}
        .rate-table td{padding:12px;border-bottom:1px solid var(--border-subtle)}
        .rate-table tr:last-child td{border-bottom:none}
        .rate-table input{padding:10px 12px;font-size:0.82rem}
        .currency-cell{display:flex;align-items:center;gap:12px;font-weight:700;color:var(--text-secondary)}
        .currency-cell img{width:34px;height:23px;border-radius:4px;object-fit:cover}
        .currency-cell span{font-weight:700;font-size:0.88rem}
        .input-spot{border-left:3px solid var(--primary)!important}
        .input-buy{border-left:3px solid var(--success)!important}
        .input-sell{border-left:3px solid var(--warning)!important}
        .syria-rates-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
        @media(max-width:600px){.syria-rates-grid{grid-template-columns:1fr}}
        .syria-city-card{background:var(--bg-input);border:1px solid var(--border-subtle);border-radius:var(--radius-md);padding:22px}
        .syria-city-card h4{font-size:0.88rem;font-weight:700;color:var(--text-primary);margin-bottom:14px}
        .syria-city-card .rate-inputs{display:grid;grid-template-columns:1fr 1fr;gap:10px}
        .syria-city-card input{padding:10px;font-size:0.82rem}
        .syria-city-card label{font-size:0.68rem}
        .rules-country-card{background:var(--bg-input);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);padding:24px;margin-bottom:20px}
        .rules-country-card h4{font-size:0.95rem;font-weight:700;color:var(--text-primary);margin-bottom:16px;display:flex;align-items:center;gap:10px}
        .rules-country-card h4 img{width:28px;height:19px;border-radius:3px}
        .rule-tier{display:grid;grid-template-columns:auto 1fr 1fr 1fr auto;gap:10px;align-items:end;padding:14px;background:var(--bg-card-solid);border:1px solid var(--border-subtle);border-radius:var(--radius-sm);margin-bottom:10px}
        @media(max-width:700px){.rule-tier{grid-template-columns:1fr 1fr}.rule-tier .tier-num{grid-column:1/-1}}
        .rule-tier label{font-size:0.65rem;margin-bottom:4px}
        .rule-tier input,.rule-tier select{padding:10px;font-size:0.82rem}
        .tier-num{display:flex;align-items:center;justify-content:center;width:32px;height:32px;background:var(--gradient-primary);border-radius:8px;color:white;font-weight:700;font-size:0.78rem;flex-shrink:0}
        .btn-add-tier{padding:10px 18px;background:transparent;border:1px dashed var(--border-color);border-radius:var(--radius-sm);color:var(--text-muted);font-size:0.78rem;font-weight:600;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:6px;font-family:inherit;width:100%}
        .btn-add-tier:hover{border-color:var(--primary);color:var(--primary);background:var(--primary-glow)}
        .btn-remove-tier{width:32px;height:32px;background:var(--danger-bg);border:1px solid var(--danger-border);border-radius:8px;color:var(--danger);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:0.9rem;transition:all 0.2s;flex-shrink:0}
        .btn-remove-tier:hover{background:var(--danger);color:white}
        .ps-city-selector{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:18px}
        .receipt-modal .modal-body{display:grid;grid-template-columns:repeat(2,1fr);gap:24px}
        @media(max-width:768px){.receipt-modal .modal-body{grid-template-columns:1fr}}
        .receipt-section h4{font-size:0.88rem;font-weight:700;color:var(--text-primary);margin-bottom:18px;padding-bottom:12px;border-bottom:1px solid var(--border-subtle);display:flex;align-items:center;gap:8px}
        .checkbox-group{display:flex;align-items:center;gap:14px;padding:20px;background:var(--bg-input);border-radius:var(--radius-md);cursor:pointer;grid-column:1/-1;border:1px solid var(--border-subtle)}
        .checkbox-group input[type="checkbox"]{width:20px;height:20px;accent-color:var(--primary)}
        .checkbox-group label{margin:0;text-transform:none;letter-spacing:0;font-size:0.88rem;color:var(--text-secondary);cursor:pointer;font-weight:500}
        .modal-footer{padding:24px 32px;border-top:1px solid var(--border-color);background:var(--bg-elevated)}
        .btn-print{width:100%;padding:18px;background:var(--gradient-primary);border:none;border-radius:var(--radius-md);color:white;font-size:0.95rem;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;transition:all 0.25s;font-family:inherit}
        .btn-print:hover{transform:translateY(-1px)}
        .toast{position:fixed;bottom:30px;right:30px;background:var(--bg-card-solid);border:1px solid var(--border-color);padding:16px 24px;border-radius:var(--radius-md);box-shadow:var(--shadow-xl);display:none;align-items:center;gap:12px;z-index:2000;max-width:400px}
        .toast.show{display:flex;animation:toastIn 0.4s}
        @keyframes toastIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        .toast.success{border-color:var(--success-border)}
        .toast.error{border-color:var(--danger-border)}
        .toast .icon{width:34px;height:34px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0}
        .toast.success .icon{background:var(--success-bg);color:var(--success)}
        .toast.error .icon{background:var(--danger-bg);color:var(--danger)}
        .toast .message{color:var(--text-primary);font-weight:500;font-size:0.88rem}
        .tab-content{display:none}.tab-content.active{display:block}
        ::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border-color);border-radius:3px}
        .calc-card,.results-card{animation:cardIn 0.5s cubic-bezier(0.16,1,0.3,1)}
        @keyframes cardIn{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
        #printableReceipt{display:none}
        @media print{body *{visibility:hidden}#printableReceipt,#printableReceipt *{visibility:visible}#printableReceipt{display:block;position:absolute;left:0;top:0;width:100%;padding:40px;background:white!important;color:black!important}.print-header{text-align:center;border-bottom:2px solid #000;padding-bottom:20px;margin-bottom:30px}.print-header h2{font-size:1.6rem;margin-bottom:8px;color:black}.print-meta{display:flex;justify-content:space-between;margin-bottom:24px;color:black}.print-grid{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:24px}.print-box{border:1px solid #e2e8f0;padding:20px;border-radius:12px}.print-box h4{margin:0 0 16px;border-bottom:1px solid #e2e8f0;padding-bottom:8px;text-transform:uppercase;font-size:0.75rem;color:#94a3b8;font-weight:700}.print-row{display:flex;justify-content:space-between;margin-bottom:8px;font-size:0.9rem;color:black}.print-total{border-top:2px solid #000;margin-top:12px;padding-top:12px;font-weight:bold;font-size:1.1rem}.signatures{display:flex;justify-content:space-between;margin-top:60px}.sig-line{width:40%;border-top:1px solid #000;text-align:center;padding-top:8px;font-weight:600;font-size:0.85rem}}
    </style>
</head>
<body>

<div class="mobile-header">
    <div class="logo"><div class="logo-icon">üí±</div><div class="logo-text"><h1>FinCalc Pro</h1></div></div>
    <button class="btn-menu" onclick="toggleSidebar()">‚ò∞</button>
</div>
<div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

<div class="app-container">
    <aside class="sidebar" id="sidebar">
        <div class="logo"><div class="logo-icon">üí±</div><div class="logo-text"><h1>FinCalc Pro</h1><span>Premium Edition</span></div></div>
        <div class="theme-toggle"><span>üé® Appearance</span><label class="theme-switch"><input type="checkbox" id="themeToggle" onchange="toggleTheme()"><span class="theme-slider"></span></label></div>
        <nav class="nav-section"><div class="nav-label">Cash</div><div class="nav-item active" data-tab="exchange" onclick="switchTab('exchange')"><img src="https://flagcdn.com/w40/ca.png"><span>Cash Exchange</span></div></nav>
        <nav class="nav-section"><div class="nav-label">Transfers</div>
            <div class="nav-item" data-tab="transfer_sy" onclick="switchTab('transfer_sy')"><img src="https://flagcdn.com/w40/sy.png"><span>Syria</span></div>
            <div class="nav-item" data-tab="transfer_jo" onclick="switchTab('transfer_jo')"><img src="https://flagcdn.com/w40/jo.png"><span>Jordan</span></div>
            <div class="nav-item" data-tab="transfer_lb" onclick="switchTab('transfer_lb')"><img src="https://flagcdn.com/w40/lb.png"><span>Lebanon</span></div>
            <div class="nav-item" data-tab="transfer_ps" onclick="switchTab('transfer_ps')"><img src="https://flagcdn.com/w40/ps.png"><span>Palestine</span></div>
            <div class="nav-item" data-tab="transfer_eg" onclick="switchTab('transfer_eg')"><img src="https://flagcdn.com/w40/eg.png"><span>Egypt</span></div>
            <div class="nav-item" data-tab="transfer_iq" onclick="switchTab('transfer_iq')"><img src="https://flagcdn.com/w40/iq.png"><span>Iraq</span></div>
        </nav>
        <div class="rates-panel">
            <div class="rates-header"><h3>Quick Rates</h3><span class="live-badge" id="liveBadge" style="display:none;">LIVE</span></div>
            <div class="rate-row"><span class="currency"><img src="https://flagcdn.com/w20/us.png"> USD</span><span class="value" id="quick_usd">‚Äî</span></div>
            <div class="rate-row"><span class="currency"><img src="https://flagcdn.com/w20/eu.png"> EUR</span><span class="value" id="quick_eur">‚Äî</span></div>
            <div class="rate-row"><span class="currency"><img src="https://flagcdn.com/w20/gb.png"> GBP</span><span class="value" id="quick_gbp">‚Äî</span></div>
            <div class="rate-row"><span class="currency"><img src="https://flagcdn.com/w20/jo.png"> JOD</span><span class="value" id="quick_jod">‚Äî</span></div>
            <button class="btn-sync-mini" onclick="fetchRates()">üîÑ Sync Now</button>
            <div class="auto-sync-info"><span class="dot"></span><span>Auto-sync: <span class="countdown" id="countdown">60</span>s</span></div>
        </div>
    </aside>

    <main class="main-content">
        <div class="top-bar">
            <div class="page-title"><h2 id="pageTitle">Cash Exchange</h2><p id="pageSubtitle">Convert currencies at competitive rates</p></div>
            <div class="top-actions"><button class="btn-settings" onclick="openSettingsModal()">‚öôÔ∏è Configure Rates</button></div>
        </div>
        <div class="calc-container">
            <div class="calc-card">
                <!-- EXCHANGE -->
                <div id="tab_exchange" class="tab-content active">
                    <h3><span class="icon">üíµ</span> Exchange Details</h3>
                    <div class="mode-toggle two-col"><button class="mode-btn active" id="ex_mode_buy" onclick="setExchangeMode('buy')">üì• Customer Buys</button><button class="mode-btn" id="ex_mode_sell" onclick="setExchangeMode('sell')">üì§ Customer Sells</button></div>
                    <div class="form-row"><div class="form-group"><label>Currency</label><div class="currency-input"><img id="flag_ex_currency" src="https://flagcdn.com/w40/us.png"><select id="ex_currency" onchange="updateFlag('ex_currency');calcExchange()"><option value="USD" data-flag="us">USD ‚Äî US Dollar</option><option value="EUR" data-flag="eu">EUR ‚Äî Euro</option><option value="GBP" data-flag="gb">GBP ‚Äî British Pound</option><option value="AED" data-flag="ae">AED ‚Äî UAE Dirham</option><option value="MXN" data-flag="mx">MXN ‚Äî Mexican Peso</option><option value="SAR" data-flag="sa">SAR ‚Äî Saudi Riyal</option><option value="JOD" data-flag="jo">JOD ‚Äî Jordanian Dinar</option><option value="TRY" data-flag="tr">TRY ‚Äî Turkish Lira</option></select></div></div><div class="form-group"><label>Amount</label><input type="number" id="ex_amount" placeholder="Enter amount..." oninput="calcExchange()"></div></div>
                </div>
                <!-- SYRIA -->
                <div id="tab_transfer_sy" class="tab-content">
                    <h3><span class="icon">üá∏üáæ</span> Transfer to Syria</h3>
                    <div class="mode-toggle five-col"><button class="mode-btn active" id="sy_mode_send_usd" onclick="setSyriaMode('send_usd')"><img src="https://flagcdn.com/w20/us.png"><span class="mode-label">Send USD</span></button><button class="mode-btn" id="sy_mode_spend_cad" onclick="setSyriaMode('spend_cad')"><img src="https://flagcdn.com/w20/ca.png"><span class="mode-label">Have CAD</span></button><button class="mode-btn" id="sy_mode_syp_cad" onclick="setSyriaMode('syp_cad')">üá∏üáæüíµ<span class="mode-label">SYP(CAD)</span></button><button class="mode-btn" id="sy_mode_syp_usd" onclick="setSyriaMode('syp_usd')">üá∏üáæüí≤<span class="mode-label">SYP(USD)</span></button><button class="mode-btn" id="sy_mode_receive_syp" onclick="setSyriaMode('receive_syp')">üéØ<span class="mode-label">Receive SYP</span></button></div>
                    <div id="syria_usd_section"><div class="form-group"><label id="lbl_sy_amount">Amount to Send (USD)</label><input type="number" id="sy_amount" placeholder="Enter amount..." oninput="handleSyriaAmountChange()"></div><div id="sy_fee_tier_badge" class="fee-tier-badge auto" style="display:none"><span id="sy_fee_tier_text">ü§ñ Auto</span></div><div class="override-zone"><div class="form-row"><div class="form-group"><label>Fee Type</label><select id="sy_fee_type" onchange="markSyriaFeeManual();calcSyriaTransfer()"><option value="fixed_cad">Fixed CAD</option><option value="fixed_usd">Fixed USD</option><option value="percent">% Commission</option></select></div><div class="form-group"><label>Fee Value</label><input type="number" id="sy_fee_val" value="20" oninput="markSyriaFeeManual();calcSyriaTransfer()"></div></div><div class="form-group"><label>Exchange Rate (USD ‚Üí CAD)</label><input type="number" id="sy_rate" step="0.0001" oninput="isSyriaRateManual=true;calcSyriaTransfer()"></div><button class="btn-reset" onclick="isSyriaFeeManual=false;isSyriaRateManual=false;handleSyriaAmountChange()">‚Ü∫ Reset to Standard Rules</button></div></div>
                    <div id="syria_syp_section" style="display:none"><div class="syria-section"><label>Select City</label><div class="city-selector" id="citySelector"></div><div class="form-group" id="syp_give_group"><label id="lbl_syp_amount">Amount Customer Gives (CAD)</label><input type="number" id="syp_customer_amount" placeholder="Enter amount..." oninput="calcSYPTransfer()"></div><div class="form-group" id="syp_receive_group" style="display:none"><label>Beneficiary Should Receive (SYP)</label><input type="number" id="syp_target_amount" placeholder="e.g. 1000000" oninput="calcReceiveSYP()"></div><div class="form-group" id="syp_pay_currency_group" style="display:none"><label>Customer Pays In</label><select id="syp_pay_currency" onchange="calcReceiveSYP()"><option value="CAD">üá®üá¶ CAD</option><option value="USD">üá∫üá∏ USD</option></select></div></div><div class="syp-result-box" id="sypResultBox"><div class="label" id="syp_result_label">Beneficiary Receives</div><div class="amount" id="syp_beneficiary_amount">0 SYP</div><div class="rate-info" id="syp_rate_info">Rate: 0 SYP per CAD</div></div><div class="syp-result-box" id="sypReverseResultBox" style="display:none;border-color:var(--primary);background:var(--primary-glow)"><div class="label" style="color:var(--primary)">Customer Must Pay</div><div class="amount" id="syp_customer_must_pay">$0.00</div><div class="rate-info" id="syp_reverse_rate_info">Including fees</div></div><div class="override-zone" style="margin-top:16px"><div class="form-row"><div class="form-group"><label>Fee (CAD)</label><input type="number" id="syp_fee" value="10" oninput="calcSYPTransferAny()"></div><div class="form-group"><label>Fee Threshold (CAD)</label><input type="number" id="syp_fee_threshold" value="500" oninput="calcSYPTransferAny()"></div></div><p style="font-size:0.78rem;color:var(--text-muted);margin-top:8px">üí° Fee of <span id="fee_display">10</span> CAD applies when amount &lt; <span id="threshold_display">500</span> CAD</p></div></div>
                </div>
                <!-- JORDAN -->
                <div id="tab_transfer_jo" class="tab-content"><h3><span class="icon">üáØüá¥</span> Transfer to Jordan</h3><div class="mode-toggle"><button class="mode-btn active" id="jo_mode_send_usd" onclick="setCountryMode('JO','send_usd')">Send USD <img src="https://flagcdn.com/w20/us.png"></button><button class="mode-btn" id="jo_mode_spend_cad" onclick="setCountryMode('JO','spend_cad')">Have CAD <img src="https://flagcdn.com/w20/ca.png"></button><button class="mode-btn" id="jo_mode_send_jod" onclick="setCountryMode('JO','send_jod')">Send JOD <img src="https://flagcdn.com/w20/jo.png"></button></div><div class="form-group"><label id="lbl_jo_amount">Amount to Send (USD)</label><input type="number" id="jo_amount" placeholder="Enter amount..." oninput="handleCountryAmountChange('JO')"></div><div id="jo_fee_tier_badge" class="fee-tier-badge auto" style="display:none"><span id="jo_fee_tier_text">ü§ñ Auto</span></div><div class="override-zone"><div class="form-row"><div class="form-group"><label>Fee Type</label><select id="jo_fee_type" onchange="markCountryFeeManual('JO');calcCountryTransfer('JO')"><option value="fixed_cad">Fixed CAD</option><option value="fixed_usd">Fixed USD</option><option value="percent">% Commission</option></select></div><div class="form-group"><label>Fee Value</label><input type="number" id="jo_fee_val" placeholder="0" oninput="markCountryFeeManual('JO');calcCountryTransfer('JO')"></div></div><div class="form-group"><label>Exchange Rate (USD ‚Üí CAD)</label><input type="number" id="jo_rate" step="0.0001" oninput="markCountryRateManual('JO')"></div><div class="form-group"><label>USD ‚Üí JOD Cross Rate</label><input type="number" id="cross_rate_jod" step="0.0001" value="1.4135" oninput="calcCountryTransfer('JO')"></div><button class="btn-reset" onclick="resetCountryDefaults('JO')">‚Ü∫ Reset</button></div></div>
                <!-- LEBANON -->
                <div id="tab_transfer_lb" class="tab-content"><h3><span class="icon">üá±üáß</span> Transfer to Lebanon</h3><div class="mode-toggle two-col"><button class="mode-btn active" id="lb_mode_send_usd" onclick="setCountryMode('LB','send_usd')">Send USD <img src="https://flagcdn.com/w20/us.png"></button><button class="mode-btn" id="lb_mode_spend_cad" onclick="setCountryMode('LB','spend_cad')">Have CAD <img src="https://flagcdn.com/w20/ca.png"></button></div><div class="form-group"><label id="lbl_lb_amount">Amount to Send (USD)</label><input type="number" id="lb_amount" placeholder="Enter amount..." oninput="handleCountryAmountChange('LB')"></div><div id="lb_fee_tier_badge" class="fee-tier-badge auto" style="display:none"><span id="lb_fee_tier_text">ü§ñ Auto</span></div><div class="override-zone"><div class="form-row"><div class="form-group"><label>Fee Type</label><select id="lb_fee_type" onchange="markCountryFeeManual('LB');calcCountryTransfer('LB')"><option value="fixed_cad">Fixed CAD</option><option value="fixed_usd">Fixed USD</option><option value="percent">% Commission</option></select></div><div class="form-group"><label>Fee Value</label><input type="number" id="lb_fee_val" placeholder="0" oninput="markCountryFeeManual('LB');calcCountryTransfer('LB')"></div></div><div class="form-group"><label>Exchange Rate (USD ‚Üí CAD)</label><input type="number" id="lb_rate" step="0.0001" oninput="markCountryRateManual('LB')"></div><button class="btn-reset" onclick="resetCountryDefaults('LB')">‚Ü∫ Reset</button></div></div>
                <!-- PALESTINE -->
                <div id="tab_transfer_ps" class="tab-content"><h3><span class="icon">üáµüá∏</span> Transfer to Palestine</h3><div class="country-section"><label style="color:var(--info)">Select Region</label><div class="ps-city-selector" id="psCitySelector"><div class="city-btn active" onclick="selectPSCity('gaza',this)"><div class="city-name">Gaza</div><div class="city-rate">Strip</div></div><div class="city-btn" onclick="selectPSCity('westbank',this)"><div class="city-name">West Bank</div><div class="city-rate">ÿßŸÑÿ∂ŸÅÿ©</div></div></div></div><div class="mode-toggle two-col"><button class="mode-btn active" id="ps_mode_send_usd" onclick="setCountryMode('PS','send_usd')">Send USD <img src="https://flagcdn.com/w20/us.png"></button><button class="mode-btn" id="ps_mode_spend_cad" onclick="setCountryMode('PS','spend_cad')">Have CAD <img src="https://flagcdn.com/w20/ca.png"></button></div><div class="form-group"><label id="lbl_ps_amount">Amount to Send (USD)</label><input type="number" id="ps_amount" placeholder="Enter amount..." oninput="handleCountryAmountChange('PS')"></div><div id="ps_fee_tier_badge" class="fee-tier-badge auto" style="display:none"><span id="ps_fee_tier_text">ü§ñ Auto</span></div><div class="override-zone"><div class="form-row"><div class="form-group"><label>Fee Type</label><select id="ps_fee_type" onchange="markCountryFeeManual('PS');calcCountryTransfer('PS')"><option value="fixed_cad">Fixed CAD</option><option value="fixed_usd">Fixed USD</option><option value="percent">% Commission</option></select></div><div class="form-group"><label>Fee Value</label><input type="number" id="ps_fee_val" placeholder="0" oninput="markCountryFeeManual('PS');calcCountryTransfer('PS')"></div></div><div class="form-group"><label>Exchange Rate (USD ‚Üí CAD)</label><input type="number" id="ps_rate" step="0.0001" oninput="markCountryRateManual('PS')"></div><button class="btn-reset" onclick="resetCountryDefaults('PS')">‚Ü∫ Reset</button></div></div>
                <!-- EGYPT -->
                <div id="tab_transfer_eg" class="tab-content"><h3><span class="icon">üá™üá¨</span> Transfer to Egypt</h3><div class="mode-toggle two-col"><button class="mode-btn active" id="eg_mode_send_usd" onclick="setCountryMode('EG','send_usd')">Send USD <img src="https://flagcdn.com/w20/us.png"></button><button class="mode-btn" id="eg_mode_spend_cad" onclick="setCountryMode('EG','spend_cad')">Have CAD <img src="https://flagcdn.com/w20/ca.png"></button></div><div class="form-group"><label id="lbl_eg_amount">Amount to Send (USD)</label><input type="number" id="eg_amount" placeholder="Enter amount..." oninput="handleCountryAmountChange('EG')"></div><div id="eg_fee_tier_badge" class="fee-tier-badge auto" style="display:none"><span id="eg_fee_tier_text">ü§ñ Auto</span></div><div class="override-zone"><div class="form-row"><div class="form-group"><label>Fee Type</label><select id="eg_fee_type" onchange="markCountryFeeManual('EG');calcCountryTransfer('EG')"><option value="fixed_cad">Fixed CAD</option><option value="fixed_usd">Fixed USD</option><option value="percent">% Commission</option></select></div><div class="form-group"><label>Fee Value</label><input type="number" id="eg_fee_val" placeholder="0" oninput="markCountryFeeManual('EG');calcCountryTransfer('EG')"></div></div><div class="form-group"><label>Exchange Rate (USD ‚Üí CAD)</label><input type="number" id="eg_rate" step="0.0001" oninput="markCountryRateManual('EG')"></div><button class="btn-reset" onclick="resetCountryDefaults('EG')">‚Ü∫ Reset</button></div></div>
                <!-- IRAQ -->
                <div id="tab_transfer_iq" class="tab-content"><h3><span class="icon">üáÆüá∂</span> Transfer to Iraq</h3><div class="mode-toggle two-col"><button class="mode-btn active" id="iq_mode_send_usd" onclick="setCountryMode('IQ','send_usd')">Send USD <img src="https://flagcdn.com/w20/us.png"></button><button class="mode-btn" id="iq_mode_spend_cad" onclick="setCountryMode('IQ','spend_cad')">Have CAD <img src="https://flagcdn.com/w20/ca.png"></button></div><div class="form-group"><label id="lbl_iq_amount">Amount to Send (USD)</label><input type="number" id="iq_amount" placeholder="Enter amount..." oninput="handleCountryAmountChange('IQ')"></div><div id="iq_fee_tier_badge" class="fee-tier-badge auto" style="display:none"><span id="iq_fee_tier_text">ü§ñ Auto</span></div><div class="override-zone"><div class="form-row"><div class="form-group"><label>Fee Type</label><select id="iq_fee_type" onchange="markCountryFeeManual('IQ');calcCountryTransfer('IQ')"><option value="fixed_cad">Fixed CAD</option><option value="fixed_usd">Fixed USD</option><option value="percent">% Commission</option></select></div><div class="form-group"><label>Fee Value</label><input type="number" id="iq_fee_val" placeholder="0" oninput="markCountryFeeManual('IQ');calcCountryTransfer('IQ')"></div></div><div class="form-group"><label>Exchange Rate (USD ‚Üí CAD)</label><input type="number" id="iq_rate" step="0.0001" oninput="markCountryRateManual('IQ')"></div><button class="btn-reset" onclick="resetCountryDefaults('IQ')">‚Ü∫ Reset</button></div></div>
            </div>
            <!-- RESULTS -->
            <div class="results-card">
                <h3>üìä Calculation Summary</h3>
                <div id="exchange_results"><div class="result-item"><span class="label">Spot Rate</span><span class="value" id="ex_res_spot">‚Äî</span></div><div class="result-item"><span class="label">Margin Type</span><span class="value" id="ex_res_type">‚Äî</span></div><div class="result-item"><span class="label">Margin Applied</span><span class="value" id="ex_res_margin">‚Äî</span></div><div class="result-divider"></div><div class="result-item highlight"><span class="label">Client Rate</span><span class="value" id="ex_res_rate">‚Äî</span></div></div>
                <div id="transfer_results" style="display:none"><div class="result-item"><span class="label">Base Amount</span><span class="value" id="tr_res_base">‚Äî</span></div><div class="result-item"><span class="label">Fee</span><span class="value" id="tr_res_fee_display">‚Äî</span></div><div class="result-item"><span class="label">Rate Used</span><span class="value" id="tr_res_rate_display">‚Äî</span></div><div class="result-divider"></div><div class="result-item"><span class="label">USD Subtotal</span><span class="value" id="tr_res_sub_usd">‚Äî</span></div><div class="jod-box" id="res_jod_final_box"><div class="label">Beneficiary Gets (JOD)</div><div class="amount" id="res_jod_final">JOD 0.00</div></div><div class="result-item" id="res_ps_city_row" style="display:none"><span class="label">Region</span><span class="value" id="res_ps_city">‚Äî</span></div><div class="result-item"><span class="label">CAD Value</span><span class="value" id="tr_res_cad_equiv">‚Äî</span></div><div class="result-item"><span class="label">CAD Fees</span><span class="value" id="tr_res_cad_fees">‚Äî</span></div></div>
                <div id="syria_results" style="display:none"><div class="result-item"><span class="label">Base Amount</span><span class="value" id="sy_res_base">‚Äî</span></div><div class="result-item"><span class="label">Fee</span><span class="value" id="sy_res_fee">‚Äî</span></div><div class="result-item"><span class="label">Rate Used</span><span class="value" id="sy_res_rate">‚Äî</span></div><div class="result-divider"></div><div id="syp_result_row" style="display:none"><div class="result-item syria-highlight"><span class="label">Beneficiary Gets (SYP)</span><span class="value" id="sy_res_syp">0 SYP</span></div><div class="result-item"><span class="label">City</span><span class="value" id="sy_res_city">‚Äî</span></div></div><div class="result-item"><span class="label">CAD Value</span><span class="value" id="sy_res_cad">‚Äî</span></div></div>
                <div class="result-total" id="resultTotal"><div class="label" id="lbl_total">Total Amount</div><div class="amount" id="final_total">$0.00 CAD</div><button class="btn-receipt" onclick="openReceiptModal()">üìù Create Receipt</button></div>
            </div>
        </div>
    </main>
</div>

<!-- SETTINGS -->
<div class="modal-overlay" id="settingsModal"><div class="modal-container"><div class="modal-header"><h3>‚öôÔ∏è Rate Configuration</h3><button class="modal-close" onclick="closeSettingsModal()">√ó</button></div><div class="modal-body"><div class="modal-tabs" id="settingsTabsContainer"><button class="modal-tab active" onclick="switchSettingsTab('rates',this)">üí± Exchange Rates</button><button class="modal-tab" onclick="switchSettingsTab('rules',this)">üìã Fee Rules</button><button class="modal-tab" onclick="switchSettingsTab('syria',this)"><img src="https://flagcdn.com/w20/sy.png"> Syria Cities</button><button class="modal-tab" onclick="switchSettingsTab('palestine',this)"><img src="https://flagcdn.com/w20/ps.png"> Palestine</button></div>
<div class="settings-section active" id="settings_rates"><div class="sync-bar"><div class="sync-info"><span class="source-label">Source</span><span class="source-name" id="currentSourceName">üìä Google Finance (Auto)</span><span class="last-update" id="lastUpdated">Syncing on load...</span></div><button class="btn-sync" onclick="fetchRates()" id="btnSync"><span class="btn-text">üîÑ Fetch Now</span><span class="spinner"></span></button></div>
<table class="rate-table"><thead><tr><th>Currency</th><th>Spot (CAD)</th><th>Buy Margin</th><th>Sell Margin</th></tr></thead><tbody>
<tr><td><div class="currency-cell"><img src="https://flagcdn.com/w40/us.png"><span>USD</span></div></td><td><input type="number" id="spot_usd" class="input-spot" step="0.0001" value="1.3500" oninput="recalcAll()"></td><td><input type="number" id="margin_usd_buy" class="input-buy" step="0.001" value="0.02" oninput="recalcAll()"></td><td><input type="number" id="margin_usd_sell" class="input-sell" step="0.001" value="0.02" oninput="recalcAll()"></td></tr>
<tr><td><div class="currency-cell"><img src="https://flagcdn.com/w40/eu.png"><span>EUR</span></div></td><td><input type="number" id="spot_eur" class="input-spot" step="0.0001" value="1.4800" oninput="recalcAll()"></td><td><input type="number" id="margin_eur_buy" class="input-buy" step="0.1" value="2.5" oninput="recalcAll()"></td><td><input type="number" id="margin_eur_sell" class="input-sell" step="0.1" value="2.5" oninput="recalcAll()"></td></tr>
<tr><td><div class="currency-cell"><img src="https://flagcdn.com/w40/gb.png"><span>GBP</span></div></td><td><input type="number" id="spot_gbp" class="input-spot" step="0.0001" value="1.7200" oninput="recalcAll()"></td><td><input type="number" id="margin_gbp_buy" class="input-buy" step="0.1" value="2.0" oninput="recalcAll()"></td><td><input type="number" id="margin_gbp_sell" class="input-sell" step="0.1" value="2.0" oninput="recalcAll()"></td></tr>
<tr><td><div class="currency-cell"><img src="https://flagcdn.com/w40/ae.png"><span>AED</span></div></td><td><input type="number" id="spot_aed" class="input-spot" step="0.0001" value="0.3680" oninput="recalcAll()"></td><td><input type="number" id="margin_aed_buy" class="input-buy" step="0.1" value="3.0" oninput="recalcAll()"></td><td><input type="number" id="margin_aed_sell" class="input-sell" step="0.1" value="3.0" oninput="recalcAll()"></td></tr>
<tr><td><div class="currency-cell"><img src="https://flagcdn.com/w40/jo.png"><span>JOD</span></div></td><td><input type="number" id="spot_jod" class="input-spot" step="0.0001" value="1.9100" oninput="recalcAll()"></td><td><input type="number" id="margin_jod_buy" class="input-buy" step="0.1" value="3.0" oninput="recalcAll()"></td><td><input type="number" id="margin_jod_sell" class="input-sell" step="0.1" value="3.0" oninput="recalcAll()"></td></tr>
<tr><td><div class="currency-cell"><img src="https://flagcdn.com/w40/mx.png"><span>MXN</span></div></td><td><input type="number" id="spot_mxn" class="input-spot" step="0.0001" value="0.0780" oninput="recalcAll()"></td><td><input type="number" id="margin_mxn_buy" class="input-buy" step="0.1" value="4.0" oninput="recalcAll()"></td><td><input type="number" id="margin_mxn_sell" class="input-sell" step="0.1" value="4.0" oninput="recalcAll()"></td></tr>
<tr><td><div class="currency-cell"><img src="https://flagcdn.com/w40/tr.png"><span>TRY</span></div></td><td><input type="number" id="spot_try" class="input-spot" step="0.0001" value="0.0420" oninput="recalcAll()"></td><td><input type="number" id="margin_try_buy" class="input-buy" step="0.1" value="5.0" oninput="recalcAll()"></td><td><input type="number" id="margin_try_sell" class="input-sell" step="0.1" value="5.0" oninput="recalcAll()"></td></tr>
<tr><td><div class="currency-cell"><img src="https://flagcdn.com/w40/sa.png"><span>SAR</span></div></td><td><input type="number" id="spot_sar" class="input-spot" step="0.0001" value="0.3600" oninput="recalcAll()"></td><td><input type="number" id="margin_sar_buy" class="input-buy" step="0.1" value="3.0" oninput="recalcAll()"></td><td><input type="number" id="margin_sar_sell" class="input-sell" step="0.1" value="3.0" oninput="recalcAll()"></td></tr>
</tbody></table></div>
<div class="settings-section" id="settings_rules"><div style="background:var(--info-bg);border:1px solid var(--info-border);border-radius:var(--radius-lg);padding:22px;margin-bottom:24px"><h4 style="color:var(--info);margin:0 0 8px;font-size:0.95rem;font-weight:700">üìã Auto-Tiered Fee Rules</h4><p style="font-size:0.82rem;color:var(--text-muted);margin:0">Tiers matched by <strong>USD amount</strong> top-down.</p></div><div id="rulesContainer"></div></div>
<div class="settings-section" id="settings_syria"><div style="background:var(--syria-bg);border:1px solid var(--syria-border);border-radius:var(--radius-lg);padding:22px;margin-bottom:24px"><h4 style="color:var(--syria);margin:0 0 8px">üá∏üáæ SYP Rates by City</h4></div><div class="syria-rates-grid" id="syriaRatesGrid"></div></div>
<div class="settings-section" id="settings_palestine"><div style="background:var(--info-bg);border:1px solid var(--info-border);border-radius:var(--radius-lg);padding:22px;margin-bottom:24px"><h4 style="color:var(--info);margin:0 0 8px">üáµüá∏ Palestine Regions</h4></div><div id="palestineRulesContainer"></div></div>
</div></div></div>

<!-- RECEIPT -->
<div class="modal-overlay receipt-modal" id="receiptModal"><div class="modal-container"><div class="modal-header"><h3>üìã Receipt & KYC</h3><button class="modal-close" onclick="closeReceiptModal()">√ó</button></div><div class="modal-body"><div class="receipt-section"><h4>üë§ Client</h4><div class="form-group"><label>Full Name</label><input type="text" id="kyc_name" placeholder="Full name..."></div><div class="form-group"><label>Address</label><input type="text" id="kyc_address" placeholder="Address..."></div><div class="form-row"><div class="form-group"><label>DOB</label><input type="date" id="kyc_dob"></div><div class="form-group"><label>Occupation</label><input type="text" id="kyc_occupation" placeholder="Occupation..."></div></div></div><div class="receipt-section"><h4>ü™™ ID</h4><div class="form-group"><label>ID Type</label><select id="kyc_id_type"><option>Driver's License</option><option>Passport</option><option>PR Card</option></select></div><div class="form-row"><div class="form-group"><label>ID Number</label><input type="text" id="kyc_id_num" placeholder="ID#"></div><div class="form-group"><label>Expiry</label><input type="date" id="kyc_expiry"></div></div><div class="form-group"><label>Issued</label><input type="text" id="kyc_issue_place" placeholder="Province/Country"></div></div><div class="checkbox-group"><input type="checkbox" id="kyc_third_party"><label for="kyc_third_party">Third Party transaction</label></div></div><div class="modal-footer"><button class="btn-print" onclick="printReceipt()">üñ®Ô∏è Print Receipt</button></div></div></div>

<div id="printableReceipt"><div class="print-header"><h2>CURRENCY EXCHANGE & TRANSFER INC.</h2><p>123 Business Street, Toronto, ON M5V 1A1</p><p><strong>MSB Registration: M12345678</strong></p></div><div class="print-meta"><div><strong>Date:</strong> <span id="p_date"></span></div><div><strong>Ref:</strong> <span id="p_ref"></span></div></div><div class="print-grid"><div class="print-box"><h4>Client</h4><div class="print-row"><span>Name:</span><span id="p_name"></span></div><div class="print-row"><span>Address:</span><span id="p_address"></span></div><div class="print-row"><span>ID:</span><span id="p_id_num"></span></div></div><div class="print-box"><h4>Transaction</h4><div class="print-row"><span>Service:</span><span id="p_service"></span></div><div class="print-row"><span>Amount:</span><span id="p_amount"></span></div><div class="print-row" id="p_syp_row" style="display:none"><span>Beneficiary Gets:</span><span id="p_syp_amt"></span></div><div class="print-row" id="p_city_row" style="display:none"><span>City/Region:</span><span id="p_city"></span></div><div class="print-row"><span>Rate:</span><span id="p_rate"></span></div><div class="print-row"><span>Fee:</span><span id="p_fee"></span></div><div class="print-total"><div class="print-row"><span>TOTAL:</span><span id="p_total"></span></div></div></div></div><div style="border:1px solid #e2e8f0;padding:16px;margin-bottom:24px;font-size:0.85rem;color:#475569;border-radius:12px"><strong>Compliance:</strong> Per FINTRAC regulations.</div><div class="signatures"><div class="sig-line">Client Signature</div><div class="sig-line">Agent Signature</div></div></div>

<div class="toast" id="toast"><div class="icon">‚úì</div><span class="message" id="toastMessage">Success!</span></div>

<script>
// ===== PROTECTION =====
document.addEventListener('contextmenu', function(e) { e.preventDefault(); });
document.addEventListener('keydown', function(e) {
    if (e.key === 'F12') { e.preventDefault(); return; }
    if ((e.ctrlKey || e.metaKey) && e.shiftKey && 'IJCKijck'.indexOf(e.key) >= 0) { e.preventDefault(); return; }
    if ((e.ctrlKey || e.metaKey) && 'USus'.indexOf(e.key) >= 0 && !e.shiftKey) { e.preventDefault(); return; }
    if (e.key === 'Escape') { closeSettingsModal(); closeReceiptModal(); }
});
</script>

<script>
// ===== CONFIG =====
var CURRENCIES = ['USD','EUR','GBP','AED','JOD','MXN','TRY','SAR'];
var GOOGLE_API = 'https://script.google.com/macros/s/AKfycbxdFSDuE-6jL6Z90iGS5iD4--m4zUrJ1kXNxuO2ZxoJs9PfyORMVm86k7xySgGcKapI/exec';
var SYNC_SECONDS = 60;
var countdownLeft = SYNC_SECONDS;
var syncInterval = null;
var countdownInterval = null;

var COUNTRY_META = {SY:{name:'Syria',flag:'sy'},JO:{name:'Jordan',flag:'jo'},LB:{name:'Lebanon',flag:'lb'},PS:{name:'Palestine',flag:'ps'},EG:{name:'Egypt',flag:'eg'},IQ:{name:'Iraq',flag:'iq'}};

var transferRules = {
    SY:[{maxUSD:500,type:'fixed_cad',val:20},{maxUSD:999999,type:'percent',val:3}],
    JO:[{maxUSD:1000,type:'fixed_usd',val:20},{maxUSD:999999,type:'percent',val:2.5}],
    LB:[{maxUSD:1000,type:'fixed_cad',val:15},{maxUSD:999999,type:'percent',val:2}],
    PS_gaza:[{maxUSD:500,type:'fixed_cad',val:15},{maxUSD:999999,type:'percent',val:2.5}],
    PS_westbank:[{maxUSD:500,type:'fixed_cad',val:15},{maxUSD:999999,type:'percent',val:2.5}],
    EG:[{maxUSD:999999,type:'fixed_cad',val:25}],
    IQ:[{maxUSD:999999,type:'percent',val:4}]
};

var syriaCities = {damascus:{name:'Damascus',cadRate:7650,usdRate:11200},aleppo:{name:'Aleppo',cadRate:7650,usdRate:11200},homs:{name:'Homs',cadRate:7600,usdRate:11100},hama:{name:'Hama',cadRate:7600,usdRate:11100},latakia:{name:'Latakia',cadRate:7650,usdRate:11200},idlib:{name:'Idlib',cadRate:7600,usdRate:11100}};

var currentTab = 'exchange', exchangeMode = 'buy', syriaMode = 'send_usd', selectedCity = 'damascus', selectedPSCity = 'gaza';
var countryModes = {JO:'send_usd',LB:'send_usd',PS:'send_usd',EG:'send_usd',IQ:'send_usd'};
var countryRateManual = {JO:false,LB:false,PS:false,EG:false,IQ:false};
var countryFeeManual = {JO:false,LB:false,PS:false,EG:false,IQ:false};
var isSyriaFeeManual = false, isSyriaRateManual = false;

function $(id) { return document.getElementById(id); }
function fmt(v,c) { return v.toLocaleString('en-CA',{style:'currency',currency:c,minimumFractionDigits:2,maximumFractionDigits:2}); }
function fmtNum(v) { return v.toLocaleString('en-CA',{minimumFractionDigits:2,maximumFractionDigits:2}); }
function fmtSYP(v) { return Math.round(v).toLocaleString('en-US')+' SYP'; }
function getClientRate() { return (parseFloat($('spot_usd').value)||0) + (parseFloat($('margin_usd_buy').value)||0); }
function ensureRate(id) { var el=$(id),v=parseFloat(el.value); if(!v||v<=0) el.value=getClientRate().toFixed(4); return parseFloat(el.value); }

function findMatchingRule(rk, usd) {
    var rules = transferRules[rk] || [];
    for (var i=0; i<rules.length; i++) { if (usd <= rules[i].maxUSD) return rules[i]; }
    return rules.length ? rules[rules.length-1] : {maxUSD:999999,type:'percent',val:0};
}
function describeTier(r) { return r.type==='percent' ? r.val+'% Commission' : r.type==='fixed_usd' ? 'Fixed $'+r.val+' USD' : 'Fixed $'+r.val+' CAD'; }
function inputToUSD(a,m,r,c) { return m==='send_usd'?a : m==='spend_cad'?(r>0?a/r:0) : m==='send_jod'?a*(c||1.4135) : a; }

function applyAutoFee(cc, usd) {
    var lo=cc.toLowerCase(), badge=$(lo+'_fee_tier_badge'), bt=$(lo+'_fee_tier_text'), ftEl=$(lo+'_fee_type'), fvEl=$(lo+'_fee_val');
    var isM = cc==='SY' ? isSyriaFeeManual : countryFeeManual[cc];
    if (!badge) return;
    if (usd<=0) { badge.style.display='none'; return; }
    badge.style.display='inline-flex';
    var rk = cc==='PS' ? 'PS_'+selectedPSCity : cc;
    var rule = findMatchingRule(rk, usd), td = describeTier(rule);
    if (!isM) { ftEl.value=rule.type; fvEl.value=rule.val; badge.className='fee-tier-badge auto'; bt.textContent='ü§ñ Auto: ‚â§$'+rule.maxUSD.toLocaleString()+' USD ‚Üí '+td; }
    else { badge.className='fee-tier-badge manual'; bt.textContent='‚úèÔ∏è Manual ‚Äî Auto: ‚â§$'+rule.maxUSD.toLocaleString()+' USD ‚Üí '+td; }
}

// ===== AUTO SYNC =====
function startAutoSync() {
    fetchRatesQuiet();
    syncInterval = setInterval(fetchRatesQuiet, SYNC_SECONDS*1000);
    countdownLeft = SYNC_SECONDS;
    countdownInterval = setInterval(function() {
        countdownLeft--;
        if (countdownLeft <= 0) countdownLeft = SYNC_SECONDS;
        var el = $('countdown');
        if (el) el.textContent = countdownLeft;
    }, 1000);
}

function fetchRatesQuiet() {
    fetch(GOOGLE_API).then(function(r){return r.json();}).then(function(data) {
        if (data && typeof data === 'object') {
            CURRENCIES.forEach(function(c) {
                if (data[c]) { var el=$('spot_'+c.toLowerCase()); if(el) el.value=parseFloat(data[c]).toFixed(4); }
            });
            $('lastUpdated').textContent = 'Last sync: '+new Date().toLocaleTimeString();
            $('liveBadge').style.display = 'flex';
            recalcAll(); saveRates();
        }
    }).catch(function(){});
}

function fetchRates() {
    var btn = $('btnSync'); btn.classList.add('loading');
    fetch(GOOGLE_API).then(function(r){return r.json();}).then(function(data) {
        if (data && typeof data === 'object') {
            CURRENCIES.forEach(function(c) {
                if (data[c]) { var el=$('spot_'+c.toLowerCase()); if(el) el.value=parseFloat(data[c]).toFixed(4); }
            });
            $('lastUpdated').textContent = 'Last sync: '+new Date().toLocaleTimeString();
            $('liveBadge').style.display = 'flex';
            recalcAll(); saveRates(); showToast('Rates updated!');
        }
        btn.classList.remove('loading'); countdownLeft = SYNC_SECONDS;
    }).catch(function(e) { showToast('Sync failed','error'); btn.classList.remove('loading'); });
}

// ===== INIT =====
function init() {
    initTheme(); loadSavedData(); renderCitySelector(); renderSyriaRatesGrid();
    renderRulesConfig(); renderPalestineRulesConfig();
    recalcAll(); switchTab('exchange'); startAutoSync();
}

function initTheme() { var s=localStorage.getItem('theme')||'dark'; document.documentElement.setAttribute('data-theme',s); $('themeToggle').checked=s==='light'; }
function toggleTheme() { var l=$('themeToggle').checked; document.documentElement.setAttribute('data-theme',l?'light':'dark'); localStorage.setItem('theme',l?'light':'dark'); }

function loadSavedData() {
    try { var sr=localStorage.getItem('savedRates'); if(sr) Object.entries(JSON.parse(sr)).forEach(function(e){var el=$('spot_'+e[0].toLowerCase());if(el)el.value=e[1];}); } catch(e){}
    try { var tr=localStorage.getItem('transferRules'); if(tr) transferRules=JSON.parse(tr); } catch(e){}
    try { var sc=localStorage.getItem('syriaCities'); if(sc) syriaCities=JSON.parse(sc); } catch(e){}
}
function saveRules() { localStorage.setItem('transferRules',JSON.stringify(transferRules)); }
function saveRates() { var r={}; CURRENCIES.forEach(function(c){var el=$('spot_'+c.toLowerCase());if(el)r[c]=el.value;}); localStorage.setItem('savedRates',JSON.stringify(r)); }

// ===== CITIES =====
function renderCitySelector() {
    $('citySelector').innerHTML = Object.keys(syriaCities).map(function(k){var v=syriaCities[k]; return '<div class="city-btn '+(k===selectedCity?'active':'')+'" onclick="selectCity(\''+k+'\',this)"><div class="city-name">'+v.name+'</div><div class="city-rate">'+(syriaMode==='syp_usd'?v.usdRate:v.cadRate)+' SYP</div></div>';}).join('');
}
function renderSyriaRatesGrid() {
    $('syriaRatesGrid').innerHTML = Object.keys(syriaCities).map(function(k){var v=syriaCities[k]; return '<div class="syria-city-card"><h4>üìç '+v.name+'</h4><div class="rate-inputs"><div><label>CAD/SYP</label><input type="number" value="'+v.cadRate+'" oninput="updateCityRate(\''+k+'\',\'cad\',this.value)"></div><div><label>USD/SYP</label><input type="number" value="'+v.usdRate+'" oninput="updateCityRate(\''+k+'\',\'usd\',this.value)"></div></div></div>';}).join('');
}
function updateCityRate(c,t,v) { syriaCities[c][t==='cad'?'cadRate':'usdRate']=parseFloat(v)||0; localStorage.setItem('syriaCities',JSON.stringify(syriaCities)); renderCitySelector(); calcSYPTransferAny(); }
function selectCity(c,el) { selectedCity=c; document.querySelectorAll('#citySelector .city-btn').forEach(function(b){b.classList.remove('active');}); if(el)el.classList.add('active'); calcSYPTransferAny(); }
function selectPSCity(city,el) { selectedPSCity=city; document.querySelectorAll('#psCitySelector .city-btn').forEach(function(b){b.classList.remove('active');}); if(el)el.classList.add('active'); countryFeeManual.PS=false; handleCountryAmountChange('PS'); }

// ===== RULES CONFIG =====
function renderRulesConfig() {
    $('rulesContainer').innerHTML = ['SY','JO','LB','EG','IQ'].map(function(cc){var m=COUNTRY_META[cc],r=transferRules[cc]||[]; return '<div class="rules-country-card"><h4><img src="https://flagcdn.com/w40/'+m.flag+'.png"> '+m.name+' ‚Äî Fee Tiers</h4><div id="rules_tiers_'+cc+'">'+renderTiers(cc,r)+'</div><button class="btn-add-tier" onclick="addTier(\''+cc+'\')">+ Add Tier</button></div>';}).join('');
}
function renderPalestineRulesConfig() {
    $('palestineRulesContainer').innerHTML = [{key:'PS_gaza',name:'Gaza Strip',e:'üèôÔ∏è'},{key:'PS_westbank',name:'West Bank',e:'üèîÔ∏è'}].map(function(r){var rules=transferRules[r.key]||[]; return '<div class="rules-country-card"><h4>'+r.e+' '+r.name+'</h4><div id="rules_tiers_'+r.key+'">'+renderTiers(r.key,rules)+'</div><button class="btn-add-tier" onclick="addTier(\''+r.key+'\')">+ Add Tier</button></div>';}).join('');
}
function renderTiers(rk,rules) {
    return rules.map(function(r,i){return '<div class="rule-tier"><div class="tier-num">'+(i+1)+'</div><div class="form-group" style="margin:0"><label>Max USD</label><input type="number" value="'+r.maxUSD+'" oninput="updateTier(\''+rk+'\','+i+',\'maxUSD\',this.value)"></div><div class="form-group" style="margin:0"><label>Fee Type</label><select onchange="updateTier(\''+rk+'\','+i+',\'type\',this.value)"><option value="fixed_cad"'+(r.type==='fixed_cad'?' selected':'')+'>Fixed CAD</option><option value="fixed_usd"'+(r.type==='fixed_usd'?' selected':'')+'>Fixed USD</option><option value="percent"'+(r.type==='percent'?' selected':'')+'>% Commission</option></select></div><div class="form-group" style="margin:0"><label>Value</label><input type="number" step="0.1" value="'+r.val+'" oninput="updateTier(\''+rk+'\','+i+',\'val\',this.value)"></div><button class="btn-remove-tier" onclick="removeTier(\''+rk+'\','+i+')"'+(rules.length<=1?' disabled style="opacity:0.3"':'')+'>√ó</button></div>';}).join('');
}
function updateTier(rk,i,f,v) { if(!transferRules[rk])return; transferRules[rk][i][f]=f==='type'?v:(parseFloat(v)||0); saveRules(); }
function addTier(rk) { if(!transferRules[rk])transferRules[rk]=[]; transferRules[rk].push({maxUSD:999999,type:'fixed_cad',val:0}); saveRules(); var c=$('rules_tiers_'+rk); if(c)c.innerHTML=renderTiers(rk,transferRules[rk]); }
function removeTier(rk,i) { if(!transferRules[rk]||transferRules[rk].length<=1)return; transferRules[rk].splice(i,1); saveRules(); var c=$('rules_tiers_'+rk); if(c)c.innerHTML=renderTiers(rk,transferRules[rk]); }

// ===== NAV =====
function toggleSidebar() { $('sidebar').classList.toggle('open'); $('sidebarOverlay').classList.toggle('active'); }
function updateFlag(id) { var sel=$(id),opt=sel.options[sel.selectedIndex],f=opt.getAttribute('data-flag'),img=$('flag_'+id); if(img&&f)img.src='https://flagcdn.com/w40/'+f+'.png'; }
function showToast(msg,type) { var t=$('toast'); t.className='toast '+(type||'success')+' show'; $('toastMessage').textContent=msg; setTimeout(function(){t.classList.remove('show');},4000); }
function openSettingsModal() { $('settingsModal').classList.add('active'); renderRulesConfig(); renderPalestineRulesConfig(); }
function closeSettingsModal() { $('settingsModal').classList.remove('active'); }
function switchSettingsTab(tab,btn) { document.querySelectorAll('#settingsTabsContainer .modal-tab').forEach(function(t){t.classList.remove('active');}); document.querySelectorAll('.settings-section').forEach(function(s){s.classList.remove('active');}); if(btn)btn.classList.add('active'); $('settings_'+tab).classList.add('active'); }
function openReceiptModal() { $('receiptModal').classList.add('active'); }
function closeReceiptModal() { $('receiptModal').classList.remove('active'); }

function switchTab(t) {
    currentTab = t;
    if (window.innerWidth <= 1024) toggleSidebar();
    document.querySelectorAll('.nav-item').forEach(function(el){ el.classList.toggle('active', el.getAttribute('data-tab')===t); });
    var titles = {exchange:['Cash Exchange','Convert currencies at competitive rates'],transfer_sy:['Transfer to Syria','Send money to Syria'],transfer_jo:['Transfer to Jordan','Send money to Jordan'],transfer_lb:['Transfer to Lebanon','Send money to Lebanon'],transfer_ps:['Transfer to Palestine','Send to Gaza or West Bank'],transfer_eg:['Transfer to Egypt','Send money to Egypt'],transfer_iq:['Transfer to Iraq','Send money to Iraq']};
    $('pageTitle').textContent = (titles[t]||titles.exchange)[0];
    $('pageSubtitle').textContent = (titles[t]||titles.exchange)[1];
    document.querySelectorAll('.tab-content').forEach(function(el){ el.classList.remove('active'); });
    $('tab_'+t).classList.add('active');
    ['exchange_results','transfer_results','syria_results'].forEach(function(id){ $(id).style.display='none'; });
    $('res_jod_final_box').style.display='none'; $('res_ps_city_row').style.display='none'; $('resultTotal').classList.remove('syria-total');

    if (t==='exchange') { $('exchange_results').style.display='block'; $('lbl_total').textContent='Total CAD'; calcExchange(); }
    else if (t==='transfer_sy') { $('syria_results').style.display='block'; setSyriaMode(syriaMode); }
    else if (t==='transfer_jo') { $('transfer_results').style.display='block'; $('res_jod_final_box').style.display='block'; handleCountryAmountChange('JO'); }
    else if (t==='transfer_ps') { $('transfer_results').style.display='block'; $('res_ps_city_row').style.display='flex'; $('res_ps_city').textContent=selectedPSCity==='gaza'?'Gaza':'West Bank'; handleCountryAmountChange('PS'); }
    else { var cc=t.replace('transfer_','').toUpperCase(); $('transfer_results').style.display='block'; handleCountryAmountChange(cc); }
}

// ===== EXCHANGE =====
function setExchangeMode(m) { exchangeMode=m; $('ex_mode_buy').classList.toggle('active',m==='buy'); $('ex_mode_sell').classList.toggle('active',m==='sell'); calcExchange(); }
function calcExchange() {
    var cur=$('ex_currency').value, amt=parseFloat($('ex_amount').value)||0, code=cur.toLowerCase(), spot=parseFloat($('spot_'+code).value)||0;
    var finalRate,marginTxt,typeTxt;
    if (cur==='USD') { var mB=parseFloat($('margin_usd_buy').value)||0, mS=parseFloat($('margin_usd_sell').value)||0; typeTxt='Fixed (Points)'; finalRate=exchangeMode==='buy'?spot+mB:spot-mS; marginTxt=exchangeMode==='buy'?'+'+mB:'-'+mS; }
    else { var mB=parseFloat($('margin_'+code+'_buy').value)||0, mS=parseFloat($('margin_'+code+'_sell').value)||0; typeTxt='Percentage'; finalRate=exchangeMode==='buy'?spot*(1+mB/100):spot*(1-mS/100); marginTxt=exchangeMode==='buy'?'+'+mB+'%':'-'+mS+'%'; }
    $('ex_res_spot').textContent=spot.toFixed(4); $('ex_res_type').textContent=typeTxt; $('ex_res_margin').textContent=marginTxt; $('ex_res_rate').textContent=finalRate.toFixed(4); $('final_total').textContent=fmt(amt*finalRate,'CAD');
}

// ===== GENERIC COUNTRY =====
function setCountryMode(cc,mode) {
    countryModes[cc]=mode; var lo=cc.toLowerCase();
    document.querySelectorAll('#tab_transfer_'+lo+' .mode-btn').forEach(function(b){b.classList.remove('active');});
    var btn=$(lo+'_mode_'+mode); if(btn) btn.classList.add('active');
    var map={send_usd:['Amount to Send (USD)','Collect (CAD)'],spend_cad:['Total Cash (CAD)','Beneficiary Gets (USD)'],send_jod:['Amount to Send (JOD)','Collect (CAD)']};
    var lbl=map[mode]||map.send_usd;
    var el=$('lbl_'+lo+'_amount'); if(el)el.textContent=lbl[0]; $('lbl_total').textContent=lbl[1];
    handleCountryAmountChange(cc);
}
function handleCountryAmountChange(cc) {
    var lo=cc.toLowerCase(), mode=countryModes[cc];
    if (!countryRateManual[cc]) $(lo+'_rate').value=getClientRate().toFixed(4);
    var rate=ensureRate(lo+'_rate'), cross=cc==='JO'?(parseFloat($('cross_rate_jod').value)||1.4135):1;
    var amt=parseFloat($(lo+'_amount').value)||0, usdAmt=inputToUSD(amt,mode,rate,cross);
    applyAutoFee(cc,usdAmt); calcCountryTransfer(cc);
}
function markCountryFeeManual(cc) { countryFeeManual[cc]=true; handleCountryAmountChange(cc); }
function markCountryRateManual(cc) { countryRateManual[cc]=true; calcCountryTransfer(cc); }
function resetCountryDefaults(cc) { countryRateManual[cc]=false; countryFeeManual[cc]=false; handleCountryAmountChange(cc); }

function calcCountryTransfer(cc) {
    var lo=cc.toLowerCase(), iv=parseFloat($(lo+'_amount').value)||0, fT=$(lo+'_fee_type').value, fV=parseFloat($(lo+'_fee_val').value)||0, rate=ensureRate(lo+'_rate'), mode=countryModes[cc], cross=cc==='JO'?(parseFloat($('cross_rate_jod').value)||1.4135):1;
    var bU=0,fTx='',sU=0,cV=0,cF=0;

    if (mode==='send_usd') {
        bU=iv;
        if(fT==='percent'){var f=bU*(fV/100);sU=bU+f;fTx=fV+'% ($'+fmtNum(f)+' USD)';cV=sU*rate;}
        else if(fT==='fixed_usd'){sU=bU+fV;fTx='$'+fmtNum(fV)+' USD';cV=sU*rate;}
        else{sU=bU;fTx='$'+fmtNum(fV)+' CAD';cV=sU*rate;cF=fV;}
        $('tr_res_base').textContent=fmt(bU,'USD'); $('final_total').textContent=fmt(cV+cF,'CAD'); $('lbl_total').textContent='Collect (CAD)';
    } else if (mode==='spend_cad') {
        var tC=iv;
        if(fT==='fixed_cad'){cF=fV;fTx='$'+fmtNum(fV)+' CAD';cV=tC-cF;bU=cV/rate;}
        else if(fT==='fixed_usd'){fTx='$'+fmtNum(fV)+' USD';cV=tC;sU=cV/rate;bU=sU-fV;}
        else{fTx=fV+'% Comm';cV=tC;sU=tC/rate;bU=sU*(1-fV/100);}
        $('tr_res_base').textContent=fmt(bU,'USD'); $('final_total').textContent=fmt(bU,'USD'); $('lbl_total').textContent='Beneficiary Gets (USD)';
    } else if (mode==='send_jod') {
        bU=iv*cross;
        if(fT==='percent'){var f=bU*(fV/100);sU=bU+f;fTx=fV+'% ($'+fmtNum(f)+' USD)';cV=sU*rate;}
        else if(fT==='fixed_usd'){sU=bU+fV;fTx='$'+fmtNum(fV)+' USD';cV=sU*rate;}
        else{sU=bU;fTx='$'+fmtNum(fV)+' CAD';cV=sU*rate;cF=fV;}
        $('tr_res_base').textContent=fmt(bU,'USD'); $('final_total').textContent=fmt(cV+cF,'CAD'); $('lbl_total').textContent='Collect (CAD)';
    }
    if(cc==='JO') $('res_jod_final').textContent='JOD '+fmtNum(mode==='send_jod'?iv:bU/cross);
    if(cc==='PS') $('res_ps_city').textContent=selectedPSCity==='gaza'?'Gaza':'West Bank';
    $('tr_res_fee_display').textContent=fTx; $('tr_res_rate_display').textContent=rate.toFixed(4); $('tr_res_sub_usd').textContent=fmt(sU||bU,'USD'); $('tr_res_cad_equiv').textContent=fmt(cV,'CAD'); $('tr_res_cad_fees').textContent=fmt(cF,'CAD');
}

// ===== SYRIA =====
function setSyriaMode(mode) {
    syriaMode=mode;
    document.querySelectorAll('#tab_transfer_sy .mode-btn').forEach(function(b){b.classList.remove('active','syria-active');});
    var btn=$('sy_mode_'+mode); btn.classList.add('active');
    if(['syp_cad','syp_usd','receive_syp'].indexOf(mode)>=0) btn.classList.add('syria-active');
    var uS=$('syria_usd_section'),sS=$('syria_syp_section'),sR=$('syp_result_row'),rT=$('resultTotal');
    var gG=$('syp_give_group'),rG=$('syp_receive_group'),pG=$('syp_pay_currency_group'),sB=$('sypResultBox'),rB=$('sypReverseResultBox');

    if(mode==='syp_cad'||mode==='syp_usd') {
        uS.style.display='none';sS.style.display='block';sR.style.display='block';rT.classList.add('syria-total');
        gG.style.display='block';rG.style.display='none';pG.style.display='none';sB.style.display='block';rB.style.display='none';
        $('syp_result_label').textContent='Beneficiary Receives';
        $('lbl_syp_amount').textContent=mode==='syp_cad'?'Amount Customer Gives (CAD)':'Amount Customer Gives (USD)';
        renderCitySelector(); calcSYPTransfer();
    } else if(mode==='receive_syp') {
        uS.style.display='none';sS.style.display='block';sR.style.display='block';rT.classList.add('syria-total');
        gG.style.display='none';rG.style.display='block';pG.style.display='block';sB.style.display='block';rB.style.display='block';
        $('syp_result_label').textContent='Beneficiary Will Receive';
        renderCitySelector(); calcReceiveSYP();
    } else {
        uS.style.display='block';sS.style.display='none';sR.style.display='none';rT.classList.remove('syria-total');
        $('lbl_sy_amount').textContent=mode==='send_usd'?'Amount to Send (USD)':'Total Cash (CAD)';
        $('lbl_total').textContent=mode==='send_usd'?'Collect (CAD)':'Beneficiary Gets (USD)';
        handleSyriaAmountChange();
    }
}

function handleSyriaAmountChange() {
    if(!isSyriaRateManual) $('sy_rate').value=getClientRate().toFixed(4);
    var rate=ensureRate('sy_rate'), amt=parseFloat($('sy_amount').value)||0;
    var usd = syriaMode==='spend_cad' ? (rate>0?amt/rate:0) : amt;
    applyAutoFee('SY',usd); calcSyriaTransfer();
}
function markSyriaFeeManual() { isSyriaFeeManual=true; var rate=ensureRate('sy_rate'),amt=parseFloat($('sy_amount').value)||0; applyAutoFee('SY',syriaMode==='spend_cad'?(rate>0?amt/rate:0):amt); }

function calcSYPTransferAny() { syriaMode==='receive_syp'?calcReceiveSYP():calcSYPTransfer(); }

function calcSYPTransfer() {
    var amt=parseFloat($('syp_customer_amount').value)||0, fee=parseFloat($('syp_fee').value)||0, thr=parseFloat($('syp_fee_threshold').value)||500, city=syriaCities[selectedCity];
    $('fee_display').textContent=fee; $('threshold_display').textContent=thr;
    var aFee=amt<thr?fee:0, net=amt-aFee, rate=syriaMode==='syp_usd'?city.usdRate:city.cadRate, syp=net*rate;
    var cur=syriaMode==='syp_usd'?'USD':'CAD';
    $('syp_beneficiary_amount').textContent=fmtSYP(syp); $('syp_rate_info').textContent='Rate: '+rate.toLocaleString()+' SYP per '+cur+' ('+city.name+')';
    $('sy_res_base').textContent=fmt(amt,cur); $('sy_res_fee').textContent=aFee>0?fmt(aFee,cur):'No fee'; $('sy_res_rate').textContent=rate.toLocaleString()+' SYP';
    $('sy_res_syp').textContent=fmtSYP(syp); $('sy_res_city').textContent=city.name; $('sy_res_cad').textContent=syriaMode==='syp_usd'?'‚Äî':fmt(amt,'CAD');
    $('lbl_total').textContent=syriaMode==='syp_usd'?'Collect (USD)':'Collect (CAD)'; $('final_total').textContent=fmt(amt,cur);
}

function calcReceiveSYP() {
    var target=parseFloat($('syp_target_amount').value)||0, pay=$('syp_pay_currency').value, fee=parseFloat($('syp_fee').value)||0, thr=parseFloat($('syp_fee_threshold').value)||500, city=syriaCities[selectedCity];
    $('fee_display').textContent=fee; $('threshold_display').textContent=thr;
    var rate=pay==='USD'?city.usdRate:city.cadRate, net=rate>0?target/rate:0, aFee=0, total;
    if(pay==='CAD'){aFee=net<thr?fee:0;total=net+aFee;}else{var uR=parseFloat($('spot_usd').value)||1.35;aFee=net<thr/uR?fee/uR:0;total=net+aFee;}
    var cur=pay==='USD'?'USD':'CAD';
    $('syp_beneficiary_amount').textContent=fmtSYP(target); $('syp_rate_info').textContent='Rate: '+rate.toLocaleString()+' SYP per '+pay+' ('+city.name+')';
    $('syp_customer_must_pay').textContent=fmt(total,cur); $('syp_reverse_rate_info').textContent=aFee>0?fmt(net,cur)+' + '+fmt(aFee,cur)+' fee':'No fee';
    $('sy_res_base').textContent=fmt(net,cur); $('sy_res_fee').textContent=aFee>0?fmt(aFee,cur):'No fee'; $('sy_res_rate').textContent=rate.toLocaleString()+' SYP';
    $('sy_res_syp').textContent=fmtSYP(target); $('sy_res_city').textContent=city.name; $('sy_res_cad').textContent=pay==='CAD'?fmt(total,'CAD'):'‚Äî';
    $('lbl_total').textContent='Collect ('+pay+')'; $('final_total').textContent=fmt(total,cur);
}

function calcSyriaTransfer() {
    if(['syp_cad','syp_usd'].indexOf(syriaMode)>=0) return calcSYPTransfer();
    if(syriaMode==='receive_syp') return calcReceiveSYP();
    var iv=parseFloat($('sy_amount').value)||0, fT=$('sy_fee_type').value, fV=parseFloat($('sy_fee_val').value)||0, rate=ensureRate('sy_rate');
    var bU=0,fTx='',cV=0,cF=0,sU=0;
    if(syriaMode==='send_usd') {
        bU=iv;
        if(fT==='percent'){var f=bU*(fV/100);sU=bU+f;fTx=fV+'% ($'+fmtNum(f)+' USD)';cV=sU*rate;}
        else if(fT==='fixed_usd'){sU=bU+fV;fTx='$'+fmtNum(fV)+' USD';cV=sU*rate;}
        else{sU=bU;fTx='$'+fmtNum(fV)+' CAD';cV=sU*rate;cF=fV;}
        $('sy_res_base').textContent=fmt(bU,'USD'); $('final_total').textContent=fmt(cV+cF,'CAD'); $('lbl_total').textContent='Collect (CAD)';
    } else {
        var tC=iv;
        if(fT==='fixed_cad'){cF=fV;fTx='$'+fmtNum(fV)+' CAD';cV=tC-cF;bU=cV/rate;}
        else if(fT==='fixed_usd'){fTx='$'+fmtNum(fV)+' USD';cV=tC;sU=cV/rate;bU=sU-fV;}
        else{fTx=fV+'% Comm';cV=tC;sU=tC/rate;bU=sU*(1-fV/100);}
        $('sy_res_base').textContent=fmt(bU,'USD'); $('final_total').textContent=fmt(bU,'USD'); $('lbl_total').textContent='Beneficiary Gets (USD)';
    }
    $('sy_res_fee').textContent=fTx; $('sy_res_rate').textContent=rate.toFixed(4); $('sy_res_cad').textContent=fmt(cV,'CAD');
}

// ===== RECALC =====
function recalcAll() {
    calcExchange(); updateQuickRates();
    if(currentTab==='transfer_sy'){if(['send_usd','spend_cad'].indexOf(syriaMode)>=0)handleSyriaAmountChange();else calcSYPTransferAny();}
    else if(currentTab.indexOf('transfer_')===0){var cc=currentTab.replace('transfer_','').toUpperCase();if(['JO','LB','PS','EG','IQ'].indexOf(cc)>=0)handleCountryAmountChange(cc);}
}
function updateQuickRates() { ['usd','eur','gbp','jod'].forEach(function(c){var el=$('quick_'+c),sp=$('spot_'+c);if(el&&sp){var v=parseFloat(sp.value);el.textContent=v?v.toFixed(4):'‚Äî';}}); }

// ===== RECEIPT =====
function printReceipt() {
    $('p_name').textContent=$('kyc_name').value||'‚Äî'; $('p_address').textContent=$('kyc_address').value||'‚Äî'; $('p_id_num').textContent=$('kyc_id_num').value||'‚Äî';
    var d=new Date(); $('p_date').textContent=d.toLocaleDateString()+' '+d.toLocaleTimeString(); $('p_ref').textContent='R-'+Math.floor(Math.random()*1000000);
    $('p_syp_row').style.display='none'; $('p_city_row').style.display='none';
    if(currentTab==='exchange'){$('p_service').textContent='CASH EXCHANGE ('+exchangeMode.toUpperCase()+')';$('p_amount').textContent=($('ex_amount').value||'0')+' '+$('ex_currency').value;$('p_rate').textContent=$('ex_res_rate').textContent;$('p_fee').textContent='In Rate';}
    else if(currentTab==='transfer_sy'&&['syp_cad','syp_usd','receive_syp'].indexOf(syriaMode)>=0){$('p_service').textContent='TRANSFER SYRIA (SYP)';$('p_amount').textContent=$('sy_res_base').textContent;$('p_syp_row').style.display='flex';$('p_syp_amt').textContent=$('sy_res_syp').textContent;$('p_city_row').style.display='flex';$('p_city').textContent=syriaCities[selectedCity].name;$('p_rate').textContent=$('sy_res_rate').textContent;$('p_fee').textContent=$('sy_res_fee').textContent;}
    else if(currentTab==='transfer_sy'){$('p_service').textContent='TRANSFER SYRIA';$('p_amount').textContent=$('sy_res_base').textContent;$('p_rate').textContent=$('sy_res_rate').textContent;$('p_fee').textContent=$('sy_res_fee').textContent;}
    else if(currentTab==='transfer_ps'){$('p_service').textContent='TRANSFER PALESTINE';$('p_amount').textContent=$('tr_res_base').textContent;$('p_rate').textContent=$('tr_res_rate_display').textContent;$('p_fee').textContent=$('tr_res_fee_display').textContent;$('p_city_row').style.display='flex';$('p_city').textContent=selectedPSCity==='gaza'?'Gaza':'West Bank';}
    else{var n={transfer_jo:'JORDAN',transfer_lb:'LEBANON',transfer_eg:'EGYPT',transfer_iq:'IRAQ'};$('p_service').textContent='TRANSFER '+(n[currentTab]||'');$('p_amount').textContent=$('tr_res_base').textContent;$('p_rate').textContent=$('tr_res_rate_display').textContent;$('p_fee').textContent=$('tr_res_fee_display').textContent;}
    $('p_total').textContent=$('final_total').textContent; window.print();
}

// ===== GO =====
init();
</script>
</body>
</html>
